---
title  : "Choosing the Right Center of Projection For Your Map"
description: "Each projected map should make the feature at hand the center of projection."
author : "Luke Smith"
date   : "`r Sys.Date()`"
tags   : [r, gis, map-projections, sf, ggplot2]
---

```{r load_dependencies, echo=FALSE, message=FALSE, warning=FALSE}
load("~/R/oil/data/maps/us/states_sim_shift.RData")
us <- states_sim_shift
library(sf)
library(ggplot2)
library(dplyr)
library(gridExtra)
library(cowplot)
library(extrafont); loadfonts("win", quiet = TRUE)
theme_set(theme_minimal(base_family = "Open Sans"))

knitr::opts_chunk$set(warning = FALSE)
knitr::opts_chunk$set(message = FALSE)
knitr::opts_chunk$set(comment = "#>")
```

```{r first-image, echo=FALSE, fig.height=3.5}
# Albers Equal Area
proj_bad_center <- us %>%
  filter(state == "GEORGIA") %>%
  st_transform(crs = st_crs(102003)) %>%
  ggplot() +
  geom_sf() +
  labs(title = "Default Center of Projection\n")

proj_cent_center <- us %>%
  filter(state == "GEORGIA") %>%
  st_transform(crs = "+proj=laea +lat_0=32.6 +lon_0=-83.4 +x_0=0 +y_0=0 +a=6370997 +b=6370997 +units=m +no_defs") %>%
  ggplot() +
  geom_sf() +
  labs(title = "Centroid-Based Center\nof Projection")

proj_bbox_center <- us %>%
  filter(state == "GEORGIA") %>%
  st_transform(crs = "+proj=laea +lat_0=30.3 +lon_0=-85.6 +x_0=0 +y_0=0 +a=6370997 +b=6370997 +units=m +no_defs") %>%
  ggplot() +
  geom_sf() +
  labs(title = "Bounding Box-Based\nCenter of Projection")

plot_grid(proj_bad_center + coord_sf(datum = NA),
          proj_cent_center + coord_sf(datum = NA),
          proj_bbox_center + coord_sf(datum = NA),
          ncol = 3, rel_widths = c(1, 0.87, 0.87)) %>%
  add_sub("Projection: Albers Equal  Area (EPSG: 102003)", size = 10, colour = "gray50", hjust = 0.0, fontfamily = "Open Sans") %>%
  ggdraw()
```

The following map of Georgia comes from the [Washington Posts' coverage of the 2018 primary elections](https://www.washingtonpost.com/election-results/georgia/?utm_term=.9c08d5470ad3).

![](../../blog/choosing_the_right_center_of_projection_files/extra/ga_wapo.png)

These kinds of maps - where the center of projection is not based on the feature being mapped - are seen quite often in the Washington Post, New York Times, and other major US news publishers.

The map at hand shows the state of Georgia - tilted to the left, as though rotated counter-clockwise about its center. Why is that?

## Defaults

![](https://media.giphy.com/media/xUNd9L4atjzNBpdLck/giphy.gif)
<br>

The map-making software used by the Washington Post is doing one of two things:

* Preserving the center of the contiguous 48 states
* Preserving some other default center of projection

__NOTE:__ I do not know which software they use.

Here are two maps to help explain what is going on.

```{r projection-with-no-consideration, echo=FALSE, fig.height=2.95}
# Using Albers Equal Area
# us %>%
#  filter(state == "GEORGIA") %>%
#  st_transform(crs = st_crs(102003)) %>%
#  ggplot() +
#  geom_sf() +
#  labs(title = "Default Projection")

whole_proj <- us %>%
  filter(! state %in% c("ALASKA", "HAWAII")) %>%
  ggplot() +
  geom_sf(aes(color = state == "GEORGIA", fill = state == "GEORGIA")) +
  scale_color_manual(values = c("gray50", "gray10"), guide = FALSE) +
  scale_fill_manual(values = c("gray80", "gray60"), guide = FALSE) +
  coord_sf(crs = st_crs(102003)) +
  labs(title = "Contiguous 48 States (Good Center\nof Projection)")

plot_grid(whole_proj,
          proj_bad_center + labs(title = "Georgia (Inherited\nCenter of Projection)"),
          ncol = 2, rel_heights = c(1, 0.5)) %>%
  add_sub("Projection: Albers Equal  Area (EPSG: 102003)", size = 10, colour = "gray50", hjust = 0.0, fontfamily = "Open Sans") %>%
  ggdraw()
```

## Center of Projection

The center of the projection is defined by the _latitude of origin_ and  the _central meridian_ - `lat_0` and `lon_0` within a proj4string, respectively. A proj4string describes a CRS (coordinate reference system) through the use of arguments and and their respective values.

The above map of the US and Georgia uses a proj4string generated by `st_crs(102003)`, from the R package [`sf`](https://r-spatial.github.io/sf/index.html). That function is passed to a transformation function, to tell it which projection to produce.

The central meridian (`lon_0`) produced by `st_crs(102003)` is suitable for projecting the contiguous 48 states (it uses NAD83 datum).

```{r, collapse=TRUE}
st_crs(102003)
```


## Solutions

### Finding an Appropriate Center of Projection

![](https://media.giphy.com/media/BmmfETghGOPrW/giphy.gif)
<br>

Finding a new center of projection is not so difficult, and I have two methods in mind to demonstrate.

For the following examples, I will be using:

* The R packages `sf` (GIS), [`ggplot2`](http://ggplot2.tidyverse.org/) (plotting), and [`dplyr`](http://dplyr.tidyverse.org/) (data manipulation)
* An Albers Equal  Area projection (based on EPSG 102003)
 
#### Centroid

This approach uses the coordinates of an _unprojected_ centroid as the center of projection.

These coordinates can be plugged in as values to the appropriate proj4string arguments.

```{r centroid, collapse=TRUE}
us %>%
  filter(state == "GEORGIA") %>%
  st_centroid() %>%
  st_coordinates()

us %>%
  filter(state == "GEORGIA") %>%
  st_transform(crs = "+proj=aea +lat_1=29.5 +lat_2=45.5 +lat_0=32.6 +lon_0=-83.4 +x_0=0 +y_0=0 +datum=NAD83 +units=m +no_defs") %>%
  ggplot() +
  geom_sf() +
  theme_minimal()
```

#### Bounding Box

The bounding box provides another value from which to extract a center of projection.

```{r bound-box, collapse=TRUE}
us %>%
  filter(state == "GEORGIA") %>%
  st_bbox() %>%
  {
    c(x = mean(.$xmin, .$xmax),
      y = mean(.$ymin, .$ymax))
  }

us %>%
  filter(state == "GEORGIA") %>%
  st_transform(crs = "+proj=aea +lat_1=29.5 +lat_2=45.5 +lat_0=30.3 +lon_0=-85.6 +x_0=0 +y_0=0 +datum=NAD83 +units=m +no_defs") %>%
  ggplot() +
  geom_sf() +
  theme_minimal()
```

### A Different Projection

I don't know which projection the Washington Post used in their map of Georgia, but it looks like either an Albers Equal Area or a Lambert Azimuthal Equal Area (EPSG: 2163).

These may not always be the best projections to use, especially when mapping such small regions.

#### World Mercator

This projection produces right-angle graticules (lines of latitude and longitude) - preserving directionality (i.e. east is always a straight-line to the right).

Essentially, you can ignore the center of projection when using this projection. It is a good projection for areas outside of the high-latitudes (where area distortion does occur).

```{r mercator}
us %>%
  filter(state == "GEORGIA") %>%
  st_transform(crs = st_crs(3395)) %>%
  ggplot() +
  geom_sf() +
  theme_minimal()
```

For unprojected coordinates, not specifying a projection is almost akin to using a World Mercator.

```{r no-projection}
us %>%
  filter(state == "GEORGIA") %>%
  ggplot() +
  geom_sf() +
  theme_minimal()
```

## When Not to Center
Maybe there are times when using an inherited center of projection is appropriate. 

One such case is when two maps are placed side-by-side, with one map being a subset of the other. In such a case, you may want to preserve the orientation of the subsetted feature in side-by-side map.

```{r preserving, fig.height=5, echo=FALSE}
plot_grid(whole_proj + labs(title = "Preserving Orientation"),
          proj_bad_center + labs(title = " "),
          whole_proj + labs(title = "Not Preserving Orientation"),
          proj_bbox_center + labs(title = " "),
          nrow = 2, rel_widths = c(1, 1))
```

## Long-term Solution

Many GIS programs, like `sf`, do not re-center subsetted features (to preserve the CRS across related geometries). This means that the user will have to _manually_ perform this task.

This may involve saving a custom proj4string for each known subsetted feature, and loading using that file when creating a map.
